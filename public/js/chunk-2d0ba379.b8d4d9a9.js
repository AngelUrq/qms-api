(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ba379"],{"35ef":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",[a("form",{attrs:{enctype:"multipart/form-data"}},[a("input",{ref:"file",attrs:{type:"file",id:"inputfile"},on:{change:t.selectFile}}),a("v-btn",{staticClass:"success ml-5",on:{click:t.saveFile}},[t._v("Subir")])],1),a("v-container",{attrs:{"fill-height":"",fluid:"","grid-list-xl":""}},[a("v-row",{attrs:{justify:"center"}},[a("v-col",{attrs:{cols:"12"}},[a("material-card",{attrs:{color:"deep-purple",title:"Archivos adjuntos"}},[a("v-data-table",{ref:"table",staticClass:"elevation-1",attrs:{headers:t.headers,items:t.items,"hide-default-footer":""},on:{"page-count":function(e){t.pageCount=e}},scopedSlots:t._u([{key:"item.download",fn:function(e){var i=e.item;return[a("v-btn",{staticClass:"mr-1",attrs:{"x-small":"",text:"",icon:"",color:"blue-grey lighten-1"},on:{click:function(e){return t.downloadFile(i)}}},[a("v-icon",{staticClass:"d-flex justify-end"},[t._v("mdi-download")])],1)]}},{key:"item.delete",fn:function(e){var i=e.item;return[a("v-btn",{staticClass:"mr-1",attrs:{"x-small":"",text:"",icon:"",color:"blue-grey lighten-1"},on:{click:function(e){return t.deleteAttachment(i)}}},[a("v-icon",{staticClass:"d-flex justify-end"},[t._v("mdi-delete")])],1)]}}])})],1)],1)],1)],1)],1)},s=[],n=a("bc3a"),o=a.n(n),l=a("f601"),r={data:function(){return{file:"",headers:[{sortable:!1,text:"Nombre",value:"originalName"},{sortable:!0,text:"Usuario",value:"user"},{sortable:!1,text:"Descargar",value:"download"},{sortable:!1,text:"Eliminar",value:"delete"}],items:[]}},mounted:function(){this.getAttachments()},methods:{selectFile:function(){this.file=this.$refs.file.files[0]},getAttachments:function(){if(this.$route.query.actionPlanID&&this.$route.query.activityID&&this.$route.query.userID){let t={headers:{"x-access-token":this.$store.state.token}};o.a.get(l["b"]+"/api/attachments/search/"+this.$route.query.actionPlanID+"/"+this.$route.query.activityID,t).then(e=>{this.items=[];for(let a of e.data){let e=a;o.a.get(l["b"]+"/api/users/"+e.userID,t).then(t=>{e.user=t.data.firstNames+" "+t.data.paternalLastName+" "+t.data.maternalLastName,this.items.push(e)}).catch(t=>{console.log(t)})}}).catch(t=>{console.log(t)})}},saveFile:function(){if(this.isCorrectURL()){const t=new FormData;t.append("file",this.file);let e={headers:{"x-access-token":this.$store.state.token}};o.a.post(l["b"]+"/api/attachments/upload",t,e).then(t=>{let a=t.data.file.filename,i=t.data.file.originalname,s={filePath:a,originalName:i,userID:this.$route.query.userID,actionPlanID:this.$route.query.actionPlanID,activityID:this.$route.query.activityID};o.a.post(l["b"]+"/api/attachments",s,e).then(t=>{this.file="",this.getAttachments()}).catch(t=>{console.log(t)})}).catch(t=>{console.log(t)})}},downloadFile:function(t){var e=document.createElement("a");e.href=l["b"]+"/api/attachments/download/"+t.filePath,e.click()},isCorrectURL:function(){return this.file&&this.$route.query.actionPlanID&&this.$route.query.activityID&&this.$route.query.userID},deleteAttachment:function(t){if(confirm("Â¿Quieres eliminar este archivo adjunto?")){let e={headers:{"x-access-token":this.$store.state.token}};o.a.delete(l["b"]+"/api/attachments/"+t._id,e).then(t=>{console.log(t.data),this.getAttachments()}).catch(t=>{console.log(t)})}}}},c=r,u=a("2877"),h=a("6544"),d=a.n(h),f=a("8336"),m=a("62ad"),v=a("a523"),p=a("8fea"),b=a("132d"),g=a("0fd9"),y=Object(u["a"])(c,i,s,!1,null,null,null);e["default"]=y.exports;d()(y,{VBtn:f["a"],VCol:m["a"],VContainer:v["a"],VDataTable:p["a"],VIcon:b["a"],VRow:g["a"]})}}]);
//# sourceMappingURL=chunk-2d0ba379.b8d4d9a9.js.map