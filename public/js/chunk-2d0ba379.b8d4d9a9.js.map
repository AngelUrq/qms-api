{"version":3,"sources":["webpack:///./src/views/attachments/Attachments.vue?0368","webpack:///src/views/attachments/Attachments.vue","webpack:///./src/views/attachments/Attachments.vue?2327","webpack:///./src/views/attachments/Attachments.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","ref","on","selectFile","staticClass","saveFile","_v","headers","items","$event","pageCount","scopedSlots","_u","key","fn","item","downloadFile","deleteAttachment","staticRenderFns","data","file","sortable","text","value","mounted","getAttachments","methods","$refs","files","$route","query","actionPlanID","activityID","userID","config","$store","state","token","a","get","then","response","attachment","user","firstNames","paternalLastName","maternalLastName","push","catch","error","console","log","isCorrectURL","formData","FormData","append","post","filePath","filename","originalName","originalname","link","document","createElement","href","click","confirm","delete","_id","component","VBtn","VCol","VContainer","VDataTable","VIcon","VRow"],"mappings":"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","file":"js/chunk-2d0ba379.b8d4d9a9.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',[_c('form',{attrs:{\"enctype\":\"multipart/form-data\"}},[_c('input',{ref:\"file\",attrs:{\"type\":\"file\",\"id\":\"inputfile\"},on:{\"change\":_vm.selectFile}}),_c('v-btn',{staticClass:\"success ml-5\",on:{\"click\":_vm.saveFile}},[_vm._v(\"Subir\")])],1),_c('v-container',{attrs:{\"fill-height\":\"\",\"fluid\":\"\",\"grid-list-xl\":\"\"}},[_c('v-row',{attrs:{\"justify\":\"center\"}},[_c('v-col',{attrs:{\"cols\":\"12\"}},[_c('material-card',{attrs:{\"color\":\"deep-purple\",\"title\":\"Archivos adjuntos\"}},[_c('v-data-table',{ref:\"table\",staticClass:\"elevation-1\",attrs:{\"headers\":_vm.headers,\"items\":_vm.items,\"hide-default-footer\":\"\"},on:{\"page-count\":function($event){_vm.pageCount = $event}},scopedSlots:_vm._u([{key:\"item.download\",fn:function(ref){\nvar item = ref.item;\nreturn [_c('v-btn',{staticClass:\"mr-1\",attrs:{\"x-small\":\"\",\"text\":\"\",\"icon\":\"\",\"color\":\"blue-grey lighten-1\"},on:{\"click\":function($event){return _vm.downloadFile(item)}}},[_c('v-icon',{staticClass:\"d-flex justify-end\"},[_vm._v(\"mdi-download\")])],1)]}},{key:\"item.delete\",fn:function(ref){\nvar item = ref.item;\nreturn [_c('v-btn',{staticClass:\"mr-1\",attrs:{\"x-small\":\"\",\"text\":\"\",\"icon\":\"\",\"color\":\"blue-grey lighten-1\"},on:{\"click\":function($event){return _vm.deleteAttachment(item)}}},[_c('v-icon',{staticClass:\"d-flex justify-end\"},[_vm._v(\"mdi-delete\")])],1)]}}])})],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <v-container>\r\n    <form enctype=\"multipart/form-data\">\r\n      <input type=\"file\" ref=\"file\" id=\"inputfile\" @change=\"selectFile\" />\r\n      <v-btn class=\"success ml-5\" @click=\"saveFile\">Subir</v-btn>\r\n    </form>\r\n    <v-container fill-height fluid grid-list-xl>\r\n      <v-row justify=\"center\">\r\n        <v-col cols=\"12\">\r\n          <material-card color=\"deep-purple\" title=\"Archivos adjuntos\">\r\n            <v-data-table\r\n              :headers=\"headers\"\r\n              :items=\"items\"\r\n              hide-default-footer\r\n              class=\"elevation-1\"\r\n              @page-count=\"pageCount = $event\"\r\n              ref=\"table\"\r\n            >\r\n              <template v-slot:item.download=\"{ item }\">\r\n                <v-btn\r\n                  x-small\r\n                  text\r\n                  icon\r\n                  color=\"blue-grey lighten-1\"\r\n                  class=\"mr-1\"\r\n                  @click=\"downloadFile(item)\"\r\n                >\r\n                  <v-icon class=\"d-flex justify-end\">mdi-download</v-icon>\r\n                </v-btn>\r\n              </template>\r\n              <template v-slot:item.delete=\"{ item }\">\r\n                <v-btn\r\n                  x-small\r\n                  text\r\n                  icon\r\n                  color=\"blue-grey lighten-1\"\r\n                  class=\"mr-1\"\r\n                  @click=\"deleteAttachment(item)\"\r\n                >\r\n                  <v-icon class=\"d-flex justify-end\">mdi-delete</v-icon>\r\n                </v-btn>\r\n              </template>\r\n            </v-data-table>\r\n          </material-card>\r\n        </v-col>\r\n      </v-row>\r\n    </v-container>\r\n  </v-container>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\n\r\nimport { backendURL } from '@/data.js'\r\n\r\nexport default {\r\n  data: function () {\r\n    return {\r\n      file: '',\r\n      headers: [\r\n        {\r\n          sortable: false,\r\n          text: 'Nombre',\r\n          value: 'originalName'\r\n        },\r\n        {\r\n          sortable: true,\r\n          text: 'Usuario',\r\n          value: 'user'\r\n        },\r\n        {\r\n          sortable: false,\r\n          text: 'Descargar',\r\n          value: 'download'\r\n        },\r\n        {\r\n          sortable: false,\r\n          text: 'Eliminar',\r\n          value: 'delete'\r\n        }\r\n      ],\r\n      items: []\r\n    }\r\n  },\r\n  mounted: function () {\r\n    this.getAttachments()\r\n  },\r\n  methods: {\r\n    selectFile: function () {\r\n      this.file = this.$refs.file.files[0]\r\n    },\r\n    getAttachments: function () {\r\n      if (this.$route.query.actionPlanID && this.$route.query.activityID && this.$route.query.userID) {\r\n        let config = { headers: { 'x-access-token': this.$store.state.token } }\r\n\r\n        axios\r\n          .get(backendURL + '/api/attachments/search/' + this.$route.query.actionPlanID + '/' + this.$route.query.activityID, config)\r\n          .then(response => {\r\n            this.items = []\r\n            for (let attachment of response.data) {\r\n              let item = attachment\r\n\r\n              axios\r\n                .get(backendURL + '/api/users/' + item.userID, config)\r\n                .then(response => {\r\n                  item.user =\r\n                    response.data.firstNames +\r\n                    ' ' +\r\n                    response.data.paternalLastName +\r\n                    ' ' +\r\n                    response.data.maternalLastName\r\n                  this.items.push(item)\r\n                })\r\n                .catch(error => {\r\n                  console.log(error)\r\n                })\r\n            }\r\n          })\r\n          .catch(error => {\r\n            console.log(error)\r\n          })\r\n      }\r\n    },\r\n    saveFile: function () {\r\n      if (this.isCorrectURL()) {\r\n        const formData = new FormData()\r\n        formData.append('file', this.file)\r\n\r\n        let config = {\r\n          headers: {\r\n            'x-access-token': this.$store.state.token\r\n          }\r\n        }\r\n\r\n        axios\r\n          .post(backendURL + '/api/attachments/upload', formData, config)\r\n          .then(response => {\r\n            let filePath = response.data.file.filename\r\n            let originalName = response.data.file.originalname\r\n\r\n            let attachment = {\r\n              filePath: filePath,\r\n              originalName: originalName,\r\n              userID: this.$route.query.userID,\r\n              actionPlanID: this.$route.query.actionPlanID,\r\n              activityID: this.$route.query.activityID\r\n            }\r\n\r\n            axios\r\n              .post(backendURL + '/api/attachments', attachment, config)\r\n              .then(response => {\r\n                this.file = ''\r\n                this.getAttachments()\r\n              })\r\n              .catch(error => {\r\n                console.log(error)\r\n              })\r\n          })\r\n          .catch(error => {\r\n            console.log(error)\r\n          })\r\n      }\r\n    },\r\n    downloadFile: function (attachment) {\r\n      var link = document.createElement('a')\r\n      link.href =\r\n        backendURL + '/api/attachments/download/' + attachment.filePath\r\n      link.click()\r\n    },\r\n    isCorrectURL: function () {\r\n      return (\r\n        this.file &&\r\n        this.$route.query.actionPlanID &&\r\n        this.$route.query.activityID &&\r\n        this.$route.query.userID\r\n      )\r\n    },\r\n    deleteAttachment: function (attachment) {\r\n      if (confirm('Â¿Quieres eliminar este archivo adjunto?')) {\r\n        let config = { headers: { 'x-access-token': this.$store.state.token } }\r\n\r\n        axios\r\n          .delete(backendURL + '/api/attachments/' + attachment._id, config)\r\n          .then(response => {\r\n            console.log(response.data)\r\n            this.getAttachments()\r\n          })\r\n          .catch(error => {\r\n            console.log(error)\r\n          })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../../node_modules/vuetify-loader/lib/loader.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Attachments.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/vuetify-loader/lib/loader.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Attachments.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Attachments.vue?vue&type=template&id=1ac4a8a8&\"\nimport script from \"./Attachments.vue?vue&type=script&lang=js&\"\nexport * from \"./Attachments.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCol,VContainer,VDataTable,VIcon,VRow})\n"],"sourceRoot":""}